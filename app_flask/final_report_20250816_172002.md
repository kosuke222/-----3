# マルウェア解析レポート

## 1. ファイル基本情報
| 項目 | 内容 |
| :--- | :--- |
| ファイル名 | rokrat |
| ファイルサイズ | 867 KB (887,808 バイト) |
| SHA256ハッシュ値 | 09a4adef9a7374616851e5e2a7d9539e1b9808e153538af94ad1d6d73a3a1232 |

## 2. 検体情報
| 項目 | 内容 |
| :--- | :--- |
| マルウェア名 | trojan.rokrat/midie |
| 分類 | trojan, spyware |
| 初めて登録された日 | 2024-12-28 05:48:59 UTC |

（注）初回登録日時は JSON の epoch 値（UTC）を変換して記載しています。

## 3. 通信先
| 項目 | 内容 |
| :--- | :--- |
| IPアドレス | 104.98.118.146:443, 104.98.118.160:443, 141.8.156.12:443, 141.8.156.22:443, 141.8.156.23:443, 141.8.157.67:443, 141.8.157.87:443, 184.30.153.155:80, 213.180.204.127:443, 23.216.81.152:80, 23.39.46.26:443, 23.46.228.49:443, 23.55.140.42:80, 37.140.151.2:443, 37.140.151.56:443, 37.140.151.69:443, 37.9.119.240:443, 5.45.195.143:443, 74.120.8.15:443, 74.120.8.6:443, 74.120.8.7:443, 74.120.9.233:443, 74.120.9.90:443, 87.250.241.10:443, 87.250.241.19:443, 87.250.241.1:443 |
| URL | api.disk.yandex.net, api.pcloud.com, cloud-api.yandex.net, https://api.pcloud.com/listfolder?path=/, https://api.pcloud.com:443/listfolder?path=/, https://cloud-api.yandex.net/v1/disk/resources/download?path=/Program/509F463B01A5D87E, https://cloud-api.yandex.net/v1/disk/resources/upload?path=/Comment/20F01E3F01A6E9CE&overwrite=true, （多数の cloud-api / uploader.*.disk.yandex.net エンドポイント 等）、res.public.onecdn.static.microsoft, www.microsoft.com |
| 通信パターン | 正規クラウドストレージや関連 API（Yandex Disk, pCloud 等）をコマンド&コントロール(C2)やデータ搬送に悪用する典型的なパターン。通信は HTTPS/API を利用しており、トラフィックが正規サービスになじむよう設計されているため、ネットワーク上での検出が困難になる。TLS 指紋（JA3/JA3S）情報も複数観測されている。 |
| 生死情報 | 調査未実施 |

（注）「生死情報」は本レポートでは調査未実施です。

## 4. 検体の挙動
以下は JSON 内の mitre_attack_summary と specimen_behavior（file_operations / registry_key_operations / process_tree）を総合して分析した挙動の解説です。各カテゴリでは観測された具体的な痕跡を挙げつつ、攻撃の文脈でそれが何を意味するかを説明します。

### 環境認識
- 観測内容：
  - ディスク情報取得（T1082）、ファイル列挙（T1083）、プロセス列挙（T1057）、セッションユーザ名取得（T1033/T1087）、hosts ファイルの読み取り（T1018）、レジストリ多数参照（System, Winsock, Internet Settings 等）。
  - 多数のシステム DLL（KERNEL32, ADVAPI32, CRYPT32, DPAPI 等）を開く／参照。
- 意味：
  - 初期に標的システムの構成（OSバージョン、インストールされたコンポーネント、ユーザー名、実行中プロセス）を収集することで、攻撃者はその環境に最適な横展開手段やデータ窃取対象を決定する。たとえば DPAPI や証明書ストアへのアクセスは暗号化されたシークレット取得の下準備を意味する場合がある。
- 被害観点での示唆：
  - この種の情報収集は継続的データ盗難やリモート操作に不可欠であり、権限昇格や横展開のトリガとなる。

### 防御回避
- 観測内容：
  - 難読化・パッキング（T1027, T1027.002）、スタックストリングや AES 定数の参照（T1027.005 / T1027）、PE ヘッダ解析（T1129）、SetUnhandledExceptionFilter によるアンチデバッグ技術（similar samples にて多数検出）、VM/サンドボックス検知（VM アーティファクト文字列の検出、T1518.001 / T1497 系）、デバッガ検知と遅延実行（T1622, T1497.003）。
  - プロセス注入やランタイムでの関数リンク（T1055, T1129）を示す痕跡。
- 意味：
  - 難読化・パッキングや例外フィルタの上書き、VM 検出、遅延は解析回避のための典型的手法。プロセス注入・インメモリ実行はアンチマルウェアによる検出やディスクベース検査を回避し、検体の持続性やステルス性を高める。
- 被害観点での示唆：
  - これらの回避技術は動的解析環境や自動検知ツールの有効性を低下させるため、検出・解析にはヒューリスティックや手動解析が必要になる。

（補足）SetUnhandledExceptionFilter：プロセス内の例外ハンドラを書き換えてデバッガ検出や制御フローの隠蔽に利用される技術です。

### ペイロードの内容
- 観測内容：
  - スクリーンショット取得（T1113）、DirectInput 経由でのキーログ収集の痕跡（T1056）、ファイル列挙・アップロード（file_operations の多数の一時ファイル作成・Windows フォルダ内.dat ファイルの書き込み／削除）、任意コマンド実行や外部バイナリのダウンロード・実行（OSINT 説明、類似検体の挙動）、HTTP/DNS ルックアップや HTTPS ベースの C2（T1095, T1071）。
  - クラウドストレージ API を用いたファイルアップロード/ダウンロード（cloud-api.yandex.net, api.pcloud.com 等）を利用。
- 意味：
  - 主目的は「情報窃取型 R A T（リモートアクセス型トロイ）」であり、キーログ、スクリーンショット、ファイルの収集と送信を通じて機密データを外部に抜き取る挙動を示す。クラウドサービス経由の C2 は検出回避に効果的。
- 被害観点での示唆：
  - ユーザ入力や画面の情報、ドキュメント等の定期的な窃取が想定されるため、個人情報や機密文書の漏洩リスクが高い。

### 痕跡消去
- 観測内容：
  - Windows フォルダ内のファイル削除（T1070.004）、自己削除（process_tree にて実行ファイルが書き込み後に削除される痕跡）、一時ファイルの作成／消去（%TEMP% に多数）。
- 意味：
  - ログやファイルシステム上の痕跡を削ることで、フォレンジック追跡や自動検知からの回避を図る。自己削除は展開後にドロッパーを隠蔽する典型的手口。
- 被害観点での示唆：
  - 早期のインシデント対応が遅れると、痕跡が散逸して原因追跡が困難になる。重要なログのバックアップ保存が有用。

--- 
総括コメント：本検体は ROKRAT 系（trojan.rokrat/midie）として分類される典型的な情報窃取型トロイの特徴を示しており、クラウドストレージ API を C2・データ搬送に悪用することでネットワーク上の検出を回避し、難読化・アンチ解析技術により解析を困難にしています。ファイル操作やプロセス挙動からは、ドロッパー／ランタイム展開→一時ファイル実行→情報収集→クラウドへアップロード、の流れが推定されます。

## 5. 類似検体の挙動
similar_samples_info に記載の各検体を総合して、メイン検体（rokrat）との共通点および特徴的な違いを整理します。

### 初期侵入
- 共通点：
  - LNK/悪性文書（HWP 等）や多段チェーン（LNK→PowerShell→実行）を利用した配布が多く観測されている。PowerShell を悪用して LNK からバイナリやスクリプトを抽出・実行する手法が確認される。ドロッパー型の展開（rundll32／loaddll32 経由）も共通。
- 違い：
  - 一部類似検体は ZIP＋LNK や広告配信経路、ブラウザ脆弱性を利用するなど、配布ベクトルのバリエーションがある。ある検体は Dropbox や pCloud 経由の組み合わせを利用している。

### 環境認識
- 共通点：
  - システム情報（BIOS/ハードウェア）、ユーザ情報、プロセス列挙、hosts ファイル読み取り、証明書ストア参照などを行う点は共通。これにより盗取対象や実行環境（VM か否か）を判断する。
- 違い：
  - 一部は PEB や LDR_DATA へのアクセスなど、より低レイヤの情報（PEB 参照）を行う検体もある。

### 防御回避
- 共通点：
  - パッキング・暗号（XOR など）、アンチVM（VirtualBox 文字列等）、アンチデバッグ（SetUnhandledExceptionFilter、guard page の利用、デバッガ検出）、遅延実行等の手法を複合的に利用する傾向がある。
- 違い：
  - 類似検体の中には csc.exe を利用して C# をコンパイルする、ブート設定変更（bcdedit）やドライバ作成が示唆されるものがあり、より高度または別目的な機能を持つものも混在する（例：ドロッパー→追加モジュール展開）。

### ペイロードの内容
- 共通点：
  - スクリーンショット取得、キーロギング、ファイル列挙・アップロード、コマンド実行が典型的。クラウドサービス（Yandex, pCloud, pCloud/Dropbox 等）を C2 や exfiltration に使用する点が非常に共通している。
- 違い：
  - 一部検体はドロッパー寄り（別マルウェアを展開する）、あるいは PowerShell を多用してファイルレス的に展開するもの、さらには（ある報告の）ファイル上書き（ランサムウェア様）振る舞いを示唆するものもある。よって「ROKRAT 系」としての共通機能に加え、亜種や付随するツールによって機能群は拡張される。

### 痕跡消去
- 共通点：
  - 一時ファイルやドロッパー自身の削除、Windows フォルダ内ファイルの消去、WER（Windows Error Reporting）関連生成物の操作など痕跡の曖昧化を行う。PowerShell 実行ログや一時ファイルを削除する流れも共通。
- 違い：
  - 一部サンプルはイベントログやレジストリ改変（例：Image File Execution Options の利用や AutoStart 生成）を行い、より持続性や隠蔽を強化するものがある。

総括：類似検体群は「クラウドを利用した C2」「LNK や PowerShell を用いた多段ドロップ」「アンチ解析・難読化」「情報窃取機能の基本セット」を共有しており、本検体はこれらの典型的特徴に合致します。ただし、個々のサンプルはドロッパー／ドロップ先の違いや追加モジュール（ドライバ作成、コンパイル実行、ランサム的振る舞い等）により差異があります。

## 6. 流行度
（osint_investigation.popularity_assessment を基に要点をまとめます）

- 直近の活動状況：
  - activity_level: 活発、trend: 横ばい。過去数年にわたり断続的に観測され、配布手法の変化（HWP→LNK→広告供給連鎖など）が確認されているため、依然として活発な脅威と評価される。
- サイバー攻撃に使われた例（具体的事例の抜粋）：
  - Cisco Talos（2017）による初期公開：悪性 HWP 文書を経由してペイロード配布、Twitter / Yandex / MediaFire を C2 に利用した事例（標的：韓国関連機関・団体など）。
  - Check Point 等による 2023–2024 の報告：ZIP 内 LNK による多段チェーンや広告配信経路を介したファイルレス展開、IE コンポーネント脆弱性を悪用した配布事例。
- 総合的な評価：
  - 総合判断は「活発（横ばい）」。理由は、配布ベクトルと C2 の手法が継続的に進化しており、正規サービスを悪用することで検出回避が容易だからである。一方で「Midie」等の名称はベンダーによる汎用的検出名として使われることが多く、単一の大規模 APT グループに紐づくというよりは亜種群としての観測が多い点に留意する必要がある。

## 7. IoC (Indicators of Compromise)
| 種別 | 値 |
| :--- | :--- |
| SHA256ハッシュ値 | 09a4adef9a7374616851e5e2a7d9539e1b9808e153538af94ad1d6d73a3a1232 |
| IPアドレス | 104.98.118.146:443, 104.98.118.160:443, 141.8.156.12:443, 141.8.156.22:443, 141.8.156.23:443, 141.8.157.67:443, 141.8.157.87:443, 184.30.153.155:80, 213.180.204.127:443, 23.216.81.152:80, 23.39.46.26:443, 23.46.228.49:443, 23.55.140.42:80, 37.140.151.2:443, 37.140.151.56:443, 37.140.151.69:443, 37.9.119.240:443, 5.45.195.143:443, 74.120.8.15:443, 74.120.8.6:443, 74.120.8.7:443, 74.120.9.233:443, 74.120.9.90:443, 87.250.241.10:443, 87.250.241.19:443, 87.250.241.1:443 |
| URL | api.disk.yandex.net, api.pcloud.com, cloud-api.yandex.net, https://api.pcloud.com/listfolder?path=/, https://cloud-api.yandex.net/v1/disk/resources/download?path=/Program/509F463B01A5D87E, （多数の uploader*.disk.yandex.net エンドポイント 等）, res.public.onecdn.static.microsoft, www.microsoft.com |
| 接続先の生死情報 | 調査未実施 |

（注）同一ネットワーク上での監視やブロックに利用する場合、上記 IP/URL を参照に IDS/Firewall ルールやプロキシのブロックリストへ登録することを検討してください。ただしクラウドサービスの正規ドメインを悪用しているため、誤検知を避けるために TLS 指紋や通信内容の振る舞いベースでの相関も併用することを推奨します。

---

追加の推奨対応（簡潔）
- 影響端末の隔離とメモリダンプ（プロセス注入やインメモリ実行の調査のため）。
- 上記 SHA256 を検出ルールに追加し、EDR/AV でスキャン。
- ネットワークでの cloud-api.yandex.net / api.pcloud.com への不審なアップロード通信を検出するルールを実装（JA3 / JA3S など TLS 指紋の相関も有効）。
- フォレンジック保存前に重要ログ（PowerShell 実行履歴、Windows イベント、ネットワークキャプチャ）を確保。
- ユーザ資格情報のローテーションと DPAPI に依存するサービスの再発行を検討。

以上。追加で特定のセクション（例：タイムライン、プロセス詳細、レジストリ差分）の深掘りや、検出ルール（YARA / Sigma / Snort ルール）作成が必要であればご指示ください。